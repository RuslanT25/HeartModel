@model HeartMVC.Models.HeartResultViewModel

@{
    ViewData["Title"] = "Tahmin Sonucu";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Sonuç Kartı -->
            <div class="card shadow mb-4">
                <div class="card-header bg-@Model.RiskColor text-white">
                    <h3 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Kalp Hastalığı Risk Tahmini Sonucu
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="text-center">
                                <div class="display-1 text-@Model.RiskColor mb-3">
                                    @if (Model.RiskColor == "success")
                                    {
                                        <i class="fas fa-heart"></i>
                                    }
                                    else if (Model.RiskColor == "warning")
                                    {
                                        <i class="fas fa-exclamation-triangle"></i>
                                    }
                                    else
                                    {
                                        <i class="fas fa-exclamation-circle"></i>
                                    }
                                </div>
                                <h2 class="text-@Model.RiskColor">@Model.RiskLevel</h2>
                                <h4 class="text-muted">LR Risk: %@Model.RiskProbability.ToString("F1")</h4>
                                <h5 class="text-muted">RF Risk: %@Model.FastForestProbability.ToString("F1")</h5>
                                <h5 class="mt-3">
                                    <span class="badge bg-@(Model.HasHeartDisease ? "danger" : "success") fs-6">
                                        @Model.ClassificationResult
                                    </span>
                                </h5>
                            </div>
                        </div>
                        <div class="col-md-6">
                            @{
                                var averageRisk = (Model.RiskProbability + Model.FastForestProbability) / 2;
                            }
                            <div class="mb-2">
                                <small class="text-muted">Logistic Regression (%@Model.RiskProbability.ToString("F1"))</small>
                                <div class="progress mb-1" style="height: 20px;">
                                    <div class="progress-bar bg-info" role="progressbar" 
                                         style="width: @Model.RiskProbability.ToString("F1")%" 
                                         aria-valuenow="@Model.RiskProbability" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <small class="text-muted">Random Forest (%@Model.FastForestProbability.ToString("F1"))</small>
                                <div class="progress mb-1" style="height: 20px;">
                                    <div class="progress-bar bg-primary" role="progressbar" 
                                         style="width: @Model.FastForestProbability.ToString("F1")%" 
                                         aria-valuenow="@Model.FastForestProbability" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                            @* <div class="mb-3">
                                <strong>Ortalama Risk: %@averageRisk.ToString("F1")</strong>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar bg-@Model.RiskColor" role="progressbar" 
                                         style="width: @averageRisk.ToString("F1")%" 
                                         aria-valuenow="@averageRisk" aria-valuemin="0" aria-valuemax="100">
                                        %@averageRisk.ToString("F1")
                                    </div>
                                </div>
                            </div> *@
                            <div class="alert alert-@Model.RiskColor">
                                <strong>Değerlendirme:</strong><br>
                                @Model.Message
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teknik Detaylar -->
            <div class="card shadow mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>
                        Teknik Detaylar
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card border-primary mb-3">
                                <div class="card-header bg-primary text-white">
                                    <strong><i class="fas fa-tree me-2"></i>Random Forest</strong>
                                </div>
                                <div class="card-body text-center">
                                    <h6>
                                        <span class="badge bg-@(Model.HasHeartDisease ? "danger" : "success") fs-6">
                                            @Model.ClassificationResult
                                        </span>
                                    </h6>
                                    <h6 class="text-primary mt-2">
                                        %@Model.FastForestProbability.ToString("F1")
                                    </h6>
                                    <small class="text-muted">Sınıflandırma + Olasılık</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-info mb-3">
                                <div class="card-header bg-info text-white">
                                    <strong><i class="fas fa-chart-line me-2"></i>Logistic Regression</strong>
                                </div>
                                <div class="card-body text-center">
                                    <h5 class="text-@Model.RiskColor">
                                        %@Model.RiskProbability.ToString("F1")
                                    </h5>
                                    <small class="text-muted">Risk olasılık oranı</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-warning mb-3">
                                <div class="card-header bg-warning text-dark">
                                    <strong><i class="fas fa-balance-scale me-2"></i>Model Karşılaştırma</strong>
                                </div>
                                <div class="card-body text-center">
                                    <div class="mb-2">
                                        <small class="text-muted">RF vs LR Farkı:</small>
                                    </div>
                                    <h6 class="@(Math.Abs(Model.FastForestProbability - Model.RiskProbability) > 10 ? "text-warning" : "text-success")">
                                        @{
                                            var difference = Math.Abs(Model.FastForestProbability - Model.RiskProbability);
                                        }
                                        %@difference.ToString("F1")
                                    </h6>
                                    <small class="text-muted">
                                        @(difference > 15 ? "Yüksek Fark" : difference > 5 ? "Orta Fark" : "Düşük Fark")
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Girilen Veriler -->
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Girilen Veriler
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr><td><strong>Yaş:</strong></td><td>@Model.InputData.Age</td></tr>
                                <tr><td><strong>Cinsiyet:</strong></td><td>@(Model.InputData.Sex == 1 ? "Erkek" : "Kadın")</td></tr>
                                <tr><td><strong>Göğüs Ağrısı:</strong></td><td>Tip @Model.InputData.Cp</td></tr>
                                <tr><td><strong>Kan Basıncı:</strong></td><td>@Model.InputData.Trestbps mmHg</td></tr>
                                <tr><td><strong>Kolesterol:</strong></td><td>@Model.InputData.Chol mg/dl</td></tr>
                                <tr><td><strong>Açlık Kan Şekeri:</strong></td><td>@(Model.InputData.Fbs == 1 ? "> 120 mg/dl" : "≤ 120 mg/dl")</td></tr>
                                <tr><td><strong>EKG Sonucu:</strong></td><td>@Model.InputData.Restecg</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr><td><strong>Max Kalp Atışı:</strong></td><td>@Model.InputData.Thalach bpm</td></tr>
                                <tr><td><strong>Egzersiz Anginası:</strong></td><td>@(Model.InputData.Exang == 1 ? "Evet" : "Hayır")</td></tr>
                                <tr><td><strong>ST Depresyonu:</strong></td><td>@Model.InputData.Oldpeak</td></tr>
                                <tr><td><strong>ST Eğimi:</strong></td><td>@Model.InputData.Slope</td></tr>
                                <tr><td><strong>Büyük Damar:</strong></td><td>@Model.InputData.Ca</td></tr>
                                <tr><td><strong>Thalassemia:</strong></td><td>@Model.InputData.Thal</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aksiyonlar -->
            <div class="text-center">
                <a asp-action="Index" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-redo me-2"></i>
                    Yeni Tahmin Yap
                </a>
                <button class="btn btn-secondary btn-lg" onclick="window.print()">
                    <i class="fas fa-print me-2"></i>
                    Sonucu Yazdır
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    @@media print {
        .btn { display: none !important; }
        .card { border: 1px solid #000 !important; }
    }
</style>